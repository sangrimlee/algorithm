---
id: '2503'
title: Maximum Number of Points From Grid Queries
url: https://leetcode.com/problems/maximum-number-of-points-from-grid-queries
category: Algorithms
difficulty: Hard
tags:
  - Array
  - Two Pointers
  - Breadth-First Search
  - Union Find
  - Sorting
  - Heap (Priority Queue)
  - Matrix
---

## ë¬¸ì œ ì„¤ëª…

- `m x n` í¬ê¸°ì˜ 2ì°¨ì› ì •ìˆ˜ ë°°ì—´ `grid`ì™€ í¬ê¸° `k`ì˜ ì •ìˆ˜ ë°°ì—´ `queries`ê°€ ì£¼ì–´ì§‘ë‹ˆë‹¤.
- ê° `queries[i]`ì— ëŒ€í•´ ì•„ë˜ ì´ë™ ê·œì¹™ì„ ë”°ë¼ ì–»ì„ ìˆ˜ ìˆëŠ” **ìµœëŒ€ ì ìˆ˜**ë¥¼ ê³„ì‚°í•œ í›„, ê·¸ ê²°ê³¼ë¥¼ ë°°ì—´ë¡œ ë°˜í™˜í•´ì•¼ í•©ë‹ˆë‹¤.
- **ì´ë™ ê·œì¹™**
  1. í˜„ì¬ ìœ„ì¹˜ì˜ ê°’ë³´ë‹¤ **queries[i]ê°€ í´ ê²½ìš°ì—ë§Œ ì´ë™ ê°€ëŠ¥**
  2. ì²˜ìŒ ë°©ë¬¸í•˜ëŠ” ì…€ì´ë¼ë©´ **1ì  íšë“**
  3. ì´ë™ ê°€ëŠ¥í•œ ë°©í–¥: **ìƒ, í•˜, ì¢Œ, ìš°**
  4. **ì´ë™ ê°€ëŠ¥í•œ ì…€ì´ ì—†ê±°ë‚˜ ì¡°ê±´ì„ ë§Œì¡±í•˜ì§€ ëª»í•˜ë©´ ì¢…ë£Œ.**
  5. ê° ì¿¼ë¦¬ì— ëŒ€í•´ **ë™ì¼í•œ ì…€ì„ ì—¬ëŸ¬ ë²ˆ ë°©ë¬¸í•  ìˆ˜ ìˆìŒ.**

## ë¬¸ì œ í’€ì´

### `Heap (Priority Queue)`

> ğŸ’¡ í•µì‹¬ ì•„ì´ë””ì–´
>
> - ê°’ì´ ì‘ì€ `query` ë¶€í„° ì²˜ë¦¬í•˜ë©´, **í•œ ë²ˆ ë°©ë¬¸í•œ ì…€ì„ ë‹¤ì‹œ ë°©ë¬¸í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.**
>   - ê°’ì´ ì‘ì€ `query`ê°€ ì´ë™í•  ìˆ˜ ìˆëŠ” ì…€ì€, ê°’ì´ í° `query` ë˜í•œ ì´ë™í•  ìˆ˜ ìˆë‹¤.
> - `query`ë³´ë‹¤ ì‘ì€ ì´ë™í•  ìˆ˜ ìˆëŠ” ì…€ë“¤ì„ **BFS ë°©ì‹ìœ¼ë¡œ íƒìƒ‰**í•˜ì—¬ ì ìˆ˜ë¥¼ ê³„ì‚°í•  ìˆ˜ ìˆë‹¤.

1. `queries` ì •ë ¬
   - `queries` ë°°ì—´ì„ **ì‘ì€ ê°’ë¶€í„° ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì •ë ¬**
   - ì›ë˜ ìˆœì„œë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ `[queries[i], i]` í˜•íƒœë¡œ ì €ì¥
2. Priority Queueë¥¼ í™œìš©í•œ íƒìƒ‰
   - `(0, 0)`ì—ì„œ ì‹œì‘í•˜ì—¬ ê°’ì´ ì‘ì€ ì…€ë¶€í„° ë°©ë¬¸í•©ë‹ˆë‹¤.
   - BFS ë°©ì‹ìœ¼ë¡œ **ìƒ, í•˜, ì¢Œ, ìš° ì´ë™**í•˜ë©°, ì²˜ìŒ ë°©ë¬¸í•˜ëŠ” ì…€ì€ ì ìˆ˜ë¡œ ì¶”ê°€í•©ë‹ˆë‹¤.
   - ë°©ë¬¸ ì—¬ë¶€ë¥¼ `visited` ë°°ì—´ì— ê¸°ë¡í•˜ì—¬ ì¤‘ë³µ ë°©ë¬¸ì„ ë°©ì§€í•©ë‹ˆë‹¤.
3. ê° `query`ì— ëŒ€í•œ ì ìˆ˜ ê³„ì‚°
   - í˜„ì¬ ë°©ë¬¸ ê°€ëŠ¥í•œ ì…€ì˜ ê°’ì´ `query`ë³´ë‹¤ ì‘ë‹¤ë©´ ê³„ì† íƒìƒ‰í•©ë‹ˆë‹¤.
   - ê·¸ë ‡ì§€ ì•Šìœ¼ë©´, í˜„ì¬ê¹Œì§€ì˜ ì ìˆ˜ë¥¼ ì €ì¥í•˜ê³ , ë‹¤ìŒ `query`ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.

```typescript showLineNumbers
function maxPoints(grid: number[][], queries: number[]): number[] {
  const [m, n, k] = [grid.length, grid[0].length, queries.length];
  const directions = [
    [0, 1],
    [1, 0],
    [0, -1],
    [-1, 0],
  ];
  const sortedQueries = queries.map((query, i) => [query, i]).sort((a, b) => a[0] - b[0]);

  const pq = new PriorityQueue((a, b) => a[2] - b[2]);
  pq.push([0, 0, grid[0][0]]);
  const visited = Array.from({ length: m }, () => new Array<boolean>(n).fill(false));
  visited[0][0] = true;

  let totalPoints = 0;
  const answer = new Array<number>(k).fill(0);
  for (const [query, queryIndex] of sortedQueries) {
    while (!pq.isEmpty() && pq.front()![2] < query) {
      const [cy, cx] = pq.pop()!;
      totalPoints += 1;
      for (const [dy, dx] of directions) {
        const [ny, nx] = [cy + dy, cx + dx];
        if (0 <= ny && ny < m && 0 <= nx && nx < n && !visited[ny][nx]) {
          pq.push([ny, nx, grid[ny][nx]]);
          visited[ny][nx] = true;
        }
      }
    }
    answer[queryIndex] = totalPoints;
  }
  return answer;
}
```

#### ë³µì¡ë„

- ì‹œê°„ ë³µì¡ë„: $O(k \cdot \log_2k + m \cdot n \cdot \log_2(m \cdot n))$
- ê³µê°„ ë³µì¡ë„: $O(m \cdot n + k)$

---

### `Union-Find`

> ğŸ’¡ í•µì‹¬ ì•„ì´ë””ì–´
>
> ì ìˆ˜ëŠ” (0, 0)ì—ì„œ ì´ë™í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ì…€ì˜ ê°œìˆ˜ì´ë‹¤. â†’ **Union-Findë¥¼ ì‚¬ìš©**í•˜ì—¬, `(0, 0)`ì˜ ì§‘í•©ì˜ ê°œìˆ˜ê°€ ê³§ ì ìˆ˜ê°€ ëœë‹¤.

1. `queries` ë° `grid`ë¥¼ ì •ë ¬
   - `queries` ë°°ì—´ì„ **ì‘ì€ ê°’ë¶€í„° ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì •ë ¬**
     - ì›ë˜ ìˆœì„œë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ `[queries[i], i]` í˜•íƒœë¡œ ì €ì¥
   - `grid`ì˜ ëª¨ë“  ì…€ì„ **ê°’ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬**
     - í•´ë‹¹ ê°’ì˜ ì¢Œí‘œë¥¼ ì•Œê¸° ìœ„í•´ `[grid[y][x], y, x]`ì˜ í˜•íƒœë¡œ ì €ì¥
2. **Union-Findë¥¼ í™œìš©í•œ ì˜ì—­ í™•ì¥**
   - `grid`ì˜ ê° ì…€ì„ ë°©ë¬¸í•˜ë©°, **ê°’ì´ `queries[i]`ë³´ë‹¤ ì‘ì€ ê²½ìš°** ê°™ì€ ì˜ì—­ìœ¼ë¡œ ë³‘í•©
   - **ìƒ, í•˜, ì¢Œ, ìš°** ë°©í–¥ìœ¼ë¡œ ì—°ê²°ëœ ë‚®ì€ ê°’ì˜ ì…€ë“¤ì„ **í•˜ë‚˜ì˜ ì§‘í•©ìœ¼ë¡œ ë³‘í•©**
   - `Union-Find`ë¥¼ ì‚¬ìš©í•˜ì—¬ **íš¨ìœ¨ì ìœ¼ë¡œ ê·¸ë£¹ì„ ê´€ë¦¬**í•˜ê³  í¬ê¸°ë¥¼ ì¶”ì 
3. ê° `query`ì— ëŒ€í•œ ì ìˆ˜ ê³„ì‚°
   - `query` ê°’ë³´ë‹¤ ì‘ì€ ì…€ì„ **ëª¨ë‘ í•©ì¹œ í›„**, `(0,0)`ì´ ì†í•œ ì˜ì—­ì˜ í¬ê¸°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
   - `query`ê°€ `grid[0][0]`ë³´ë‹¤ í¬ë‹¤ë©´ `(0,0)`ì—ì„œ ì´ë™ ê°€ëŠ¥í•œ ì˜ì—­ í¬ê¸°ë¥¼ ë°˜í™˜í•˜ê³ , ê·¸ë ‡ì§€ ì•Šë‹¤ë©´ `0`ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

```typescript showLineNumbers
export function maxPoints(grid: number[][], queries: number[]): number[] {
  const [m, n, k] = [grid.length, grid[0].length, queries.length];
  const directions = [
    [0, 1],
    [1, 0],
    [0, -1],
    [-1, 0],
  ];
  const sortedQueries = queries.map((query, i) => [query, i]).sort((a, b) => a[0] - b[0]);
  const sortedCells = grid
    .flat()
    .map((value, i) => [value, Math.floor(i / n), i % n])
    .sort((a, b) => a[0] - b[0]);

  const unionFind = new UnionFind(m * n);
  const result = new Array<number>(k).fill(0);

  let cellIndex = 0;
  for (const [query, queryIndex] of sortedQueries) {
    while (cellIndex < m * n && sortedCells[cellIndex][0] < query) {
      const [_, y, x] = sortedCells[cellIndex];
      const cellId = y * n + x;

      for (const [dy, dx] of directions) {
        const [ny, nx] = [y + dy, x + dx];
        if (0 <= ny && ny < m && 0 <= nx && nx < n && grid[ny][nx] < query) {
          unionFind.union(cellId, ny * n + nx);
        }
      }
      cellIndex += 1;
    }
    result[queryIndex] = query > grid[0][0] ? unionFind.getSize(0) : 0;
  }

  return result;
}

class UnionFind {
  private readonly parents: number[];
  private readonly sizes: number[];
  constructor(n: number) {
    this.parents = Array.from({ length: n }, (_, i) => i);
    this.sizes = new Array<number>(n).fill(1);
  }

  find(x: number): number {
    if (this.parents[x] !== x) {
      this.parents[x] = this.find(this.parents[x]);
    }
    return this.parents[x];
  }

  union(x: number, y: number): void {
    const parentX = this.find(x);
    const parentY = this.find(y);
    if (parentX === parentY) {
      return;
    }
    if (this.sizes[parentX] > this.sizes[parentY]) {
      this.parents[parentY] = parentX;
      this.sizes[parentX] += this.sizes[parentY];
    } else {
      this.parents[parentX] = parentY;
      this.sizes[parentY] += this.sizes[parentX];
    }
  }

  getSize(x: number): number {
    return this.sizes[this.find(x)];
  }
}
```

#### ë³µì¡ë„

- ì‹œê°„ ë³µì¡ë„: $O(k \cdot \log_2k + m \cdot n \cdot \log_2(m \cdot n))$
- ê³µê°„ ë³µì¡ë„: $O(m \cdot n + k)$
