---
id: '2179'
title: Count Good Triplets in an Array
url: https://leetcode.com/problems/count-good-triplets-in-an-array
category: Algorithms
difficulty: Hard
tags:
  - Array
  - Binary Search
  - Divide and Conquer
  - Binary Indexed Tree
  - Segment Tree
  - Merge Sort
  - Ordered Set
---

## ë¬¸ì œ ì„¤ëª…

- ê¸¸ì´ê°€ `n`ì¸ ë‘ ë°°ì—´ `nums1`ì™€ `nums2`ê°€ ì£¼ì–´ì§‘ë‹ˆë‹¤.
- ë‘ ë°°ì—´ ëª¨ë‘ `[0, 1, â€¦, n - 1]`ì˜ **ìˆœì—´(permutation)ì…ë‹ˆë‹¤.**
- **Good Triplet**ì´ë€, ì„¸ ê°’ `(x, y, z)`ì˜ ì¡°í•©ìœ¼ë¡œ, ì•„ë˜ ì¡°ê±´ì„ ëª¨ë‘ ë§Œì¡±í•´ì•¼í•©ë‹ˆë‹¤.
  - `x`, `y`, `z`ëŠ” ì„œë¡œ ë‹¤ë¥¸ ê°’ì´ë©°, ëª¨ë‘ `[0, n - 1]`ì— í¬í•¨ë©ë‹ˆë‹¤.
  - `nums1`ì—ì„œì˜ ìœ„ì¹˜ê°€ ì¦ê°€ ìˆœì„œì…ë‹ˆë‹¤.
    - $pos1_x < pos1_y < pos1_z$
  - `nums2`ì—ì„œë„ ìœ„ì¹˜ê°€ ì¦ê°€ ìˆœì„œì…ë‹ˆë‹¤.
    - $pos2_x < pos2_y < pos2_z$
- ë‘ ë°°ì—´ì˜ **Good Tripletì˜ ê°œìˆ˜ë¥¼ ë°˜í™˜**í•´ì•¼ í•©ë‹ˆë‹¤.

## ë¬¸ì œ í’€ì´

### `Binary Indexed Tree`

#### ğŸ’¡ ì•„ì´ë””ì–´

- `nums2`ì—ì„œì˜ ìœ„ì¹˜ ê¸°ì¤€ìœ¼ë¡œ `nums1`ì˜ ì¸ë±ìŠ¤ë¥¼ ì¬ë°°ì—´í•˜ì—¬, ê²°êµ­ í•˜ë‚˜ì˜ ë°°ì—´ì—ì„œ **ì¦ê°€í•˜ëŠ” ìˆœì„œì˜ Triplet ê°œìˆ˜**ë¥¼ ì°¾ëŠ” ë¬¸ì œë¡œ ë°”ê¿‰ë‹ˆë‹¤.
- **Binary Indexed Tree(BIT)ë¥¼** ì´ìš©í•´ **ì¢Œì¸¡ì— ì¡´ì¬í•˜ëŠ” ì‘ì€ ê°’ì˜ ê°œìˆ˜**ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ êµ¬í•˜ê³ ,
  ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê°€ëŠ¥í•œ Tripletì˜ ê°œìˆ˜ë¥¼ ê³„ì‚°í•œë‹¤.

#### í’€ì´ ê³¼ì •

1. `nums2`ì—ì„œì˜ ê° ê°’ì˜ ì¸ë±ìŠ¤ë¥¼ ì €ì¥í•˜ëŠ” `pos2`ë¥¼ ìƒì„±
2. `nums1`ì˜ ê°’ì„ `nums2`ì˜ ìœ„ì¹˜ ê¸°ì¤€ìœ¼ë¡œ ì¬ë°°ì—´í•œ `indexMapping` ìƒì„±
   - ì¦‰, ê° ì¸ë±ìŠ¤ì—ëŠ” `nums1[i]` ê°’ì˜ `nums2`ì—ì„œì˜ ì¸ë±ìŠ¤ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
   - $indexMapping[i] = pos2_{nums1[i]}$
3. **Binary Indexed Treeì™€ `indexMapping`**ì„ ì‚¬ìš©í•œ **Good Triplet**ì˜ ê°œìˆ˜ ê³„ì‚°.
   - `indexMapping`ì—ì„œ ì¦ê°€í•˜ëŠ” ì¸ë±ìŠ¤ë¥¼ ê°€ì§„ Tripletì„ ì°¾ìŠµë‹ˆë‹¤.
   - ê°’ì„ í•˜ë‚˜ì”© ì²˜ë¦¬í•˜ë©°, í˜„ì¬ ìœ„ì¹˜ë³´ë‹¤ ì™¼ìª½ì— ìˆëŠ” ê°’ ì¤‘ì—ì„œ ì‘ì€ ê°’ì˜ ê°œìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
   - `left`: **í˜„ì¬ ê°’ë³´ë‹¤ ì™¼ìª½ì— ìœ„ì¹˜í•˜ë©°, ì¸ë±ìŠ¤ë„ ì‘ì€ ê°’ì˜ ê°œìˆ˜**
   - `right`: **ë‚˜ë¨¸ì§€ ê°’ ì¤‘ì—ì„œ Tripletì˜ ì˜¤ë¥¸ìª½ì´ ë  ìˆ˜ ìˆëŠ” ê°’ì˜ ê°œìˆ˜**
     - `right = n - 1 - pos - (value - left)`
       - `n - 1 - pos`: **í˜„ì¬ ìœ„ì¹˜ ê¸°ì¤€ìœ¼ë¡œ ìš°ì¸¡ì— ìˆëŠ” ì „ì²´ ìš”ì†Œ ìˆ˜**
       - `value - left`: **í˜„ì¬ê¹Œì§€ ë“±ì¥í•œ ê°’ ì¤‘ ë‚˜ë³´ë‹¤ í° ê°’ ìˆ˜**
   - `left * right`: **í•´ë‹¹ ê°’ì„ ì¤‘ì‹¬ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆëŠ” Good Triplet ê°œìˆ˜**
4. **Good Triplet ê°œìˆ˜ë¥¼ ëˆ„ì í•˜ì—¬ ë°˜í™˜**

```typescript showLineNumbers
export function goodTriplets(nums1: number[], nums2: number[]): number {
  const n = nums1.length;
  const pos2 = new Array<number>(n).fill(-1);
  const indexMapping = new Array<number>(n).fill(-1);
  nums2.forEach((num2, i) => {
    pos2[num2] = i;
  });
  nums1.forEach((num1, i) => {
    indexMapping[pos2[num1]] = i;
  });

  const tree = new BinaryIndexedTree(n);
  let answer = 0;
  for (let value = 0; value < n; value++) {
    const pos = indexMapping[value];

    const left = tree.query(pos);
    tree.update(pos, 1);
    const right = n - 1 - pos - (value - left);
    answer += left * right;
  }
  return answer;
}

class BinaryIndexedTree {
  readonly size: number;
  private readonly tree: number[];

  constructor(size: number) {
    this.size = size;
    this.tree = new Array<number>(this.size + 1).fill(0);
  }

  update(index: number, delta: number): void {
    let currentIndex = index + 1;
    while (currentIndex <= this.size) {
      this.tree[currentIndex] += delta;
      currentIndex += currentIndex & -currentIndex;
    }
  }

  query(index: number): number {
    let result = 0;
    let currentIndex = index + 1;
    while (currentIndex > 0) {
      result += this.tree[currentIndex];
      currentIndex -= currentIndex & -currentIndex;
    }
    return result;
  }
}
```

#### ë³µì¡ë„

- ì‹œê°„ ë³µì¡ë„: $O(n \cdot \log_2 n)$
- ê³µê°„ ë³µì¡ë„: $O(n)$
